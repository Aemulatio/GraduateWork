<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ВКР</title>
    <link rel="stylesheet" href="../static/css/index.css">
    <link rel="icon" type="image/x-icon" href="../static/imgs/favicon.ico">
    <!--    <script src="../static/js/d3.min.js"></script>-->
    <script src="../static/js/Chart.min.js"></script>
    <!--    <script href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>-->
</head>
<body>
<div class="predict clearfix">
    <div class="predict__container container clearfix">
        <div class="predict__content ">
            <form action="" method="post" class="predict__form" name="prediction_form">
                <!--КОМАНДА-1-->
                <div class="predict__element">
                    <h2>
                        <label for="team1">Команда 1</label>
                    </h2>
                    <select name="team1" id="team1" class="predict__select" onchange="teamOne()" required>
                        <option value="" class="predict__select">Выберите команду</option>
                        {%for team in teams%}
                        <option value="{{team}}" class="predict__select">{{team}}</option>
                        {%endfor%}
                    </select>
                    <img src="" alt="" class="predict__team1-logo predict__team-logo">
                </div>
                <!--КОМАНДА-2-->
                <div class="predict__element">
                    <h2>
                        <label for="team2">Команда 2</label>
                    </h2>
                    <select name="team2" id="team2" class="predict__select" onchange="teamTwo()" required>
                        <option value="" class="predict__select">Выберите команду</option>
                        {%for team in teams%}
                        <option value="{{team}}" class="predict__select">{{team}}</option>
                        {%endfor%}
                    </select>
                    <img src="" alt="" class="predict__team2-logo predict__team-logo">
                </div>
                <!--КАРТА-->
                <div class="predict__element">
                    <h2>
                        <label for="map">Карта</label>
                    </h2>
                    <select name="map" id="map" class="predict__select" required>
                        <option value="" class="predict__select">Выберите карту</option>
                        {%for map in maps%}
                        <option value="{{map}}" class="predict__select">{{map}}</option>
                        {%endfor%}
                    </select>
                </div>
                <!--SUBMIT-->
                <p>
                    <input type="submit">
                </p>
            </form>
        </div>
    </div>
</div>

<div class="result">
    <div class="result__container container">
        <div class="result__content">
            {%if winner%}
            <div class="result__team1">

            </div>
            <div class="result__team2">

            </div>
            <div class="result__winner">
                <h3>{{winner}}</h3>
                <img src="../static/imgs/logos/{{winner}}.png" alt="{{winner}}"
                     class="result__team-logo" title="{{winner}}">
            </div>
            {%endif%}
        </div>
    </div>
</div>


<div class="graphs">
    <div class="graphs__container container">
        <div class="graphs__content">
            <div class="graphs__team1">
                <canvas id="team1__graph"></canvas>
            </div>
            <div class="graphs__team2">

            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="../static/js/jquery-3.5.1.min.js"></script>


<script type="text/javascript">
    function teamOne() {
        team1 = document.getElementById('team1')
        team1Image = document.querySelector('.predict__team1-logo')
        team1Image.setAttribute('src', '../static/imgs/logos/' + team1.options[team1.selectedIndex].value + '.png')
        team1Image.setAttribute('alt', team1.options[team1.selectedIndex].value)
        team1Image.setAttribute('title', team1.options[team1.selectedIndex].value)
    }

    function teamTwo() {
        team2 = document.getElementById('team2')
        team2Image = document.querySelector('.predict__team2-logo')
        team2Image.setAttribute('src', '../static/imgs/logos/' + team2.options[team2.selectedIndex].value + '.png')
        team2Image.setAttribute('alt', team2.options[team2.selectedIndex].value)
        team2Image.setAttribute('title', team2.options[team2.selectedIndex].value)

    }
</script>
<script type="text/javascript">
    // import(json)
    let path_matches = '../static/jsons/{{team1}}_matches.json';
    let path__wins = '../static/jsons/{{team1}}_wins.json';
    let request_m = new XMLHttpRequest();

    request_m.open('GET', path_matches);
    request_m.responseType = 'json';
    request_m.send();
    request_m.onload = function () {
        let request_w = new XMLHttpRequest();
        request_w.open('GET', path__wins);
        request_w.responseType = 'json';
        request_w.send();
        request_w.onload = function () {
            let matchesJSON_unordered = request_m.response;
            let winsJSON_unordered = request_w.response;

            //матчи
            const matchesJSON = {};
            Object.keys(matchesJSON_unordered).sort().forEach(function (key) {
                matchesJSON[key] = matchesJSON_unordered[key];
            });
            //победы
            const winsJSON = {};
            Object.keys(winsJSON_unordered).sort().forEach(function (key) {
                winsJSON[key] = winsJSON_unordered[key];
            });


            console.log(matchesJSON);
            console.log(winsJSON);

            let matches = Object.values(matchesJSON);
            let wins = Object.values(winsJSON);

            var ctx = document.getElementById('team1__graph').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(matchesJSON),
                    datasets: [
                        {
                            label: 'Количество побед команды {{team1}}',
                            backgroundColor: 'rgba(255, 99, 68, 0.2)',
                            data: wins,
                        },
                        {
                            label: 'Количество матчей команды {{team1}}',
                            backgroundColor: 'rgba(255, 99, 132, 1)',
                            data: matches,
                        }
                    ]
                },
                options: {
                    scales: {
                        xAxes: [{
                            stacked: false
                        }],
                        yAxes: [{
                            stacked: false,
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }
    }
    // var height = 500,
    //     width = 500,
    //     margin = 30,
    //     data = 0
    // d3.json("../static/jsons/{{team1}}.json", function (data) {
    //     console.log(data);
    // });

</script>
</body>
</html>