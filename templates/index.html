<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ВКР</title>
    <link rel="stylesheet" href="../static/css/index.css">
    <link rel="icon" type="image/x-icon" href="../static/imgs/favicon.ico">
    <script src="../static/js/Chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="../static/css/semantic.min.css">

    <!--    <link rel="stylesheet" href="../static/fullpage/fullpage.min.css">-->
    <link rel="stylesheet" href="../static/pagepilling/jquery.pagepiling.min.css">

    <script type="text/javascript" src="../static/js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="../static/js/semantic.min.js"></script>

    <script type="text/javascript" src="../static/js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="../static/slick/slick.min.js"></script>
    <!--    <script type="text/javascript" src="../static/fullpage/fullpage.min.js"></script>-->
    <!--    <script type="text/javascript" src="../static/fullpage/fullpage.extensions.min.js"></script>-->

    <link rel="stylesheet" type="text/css" href="../static/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="../static/slick/slick-theme.css"/>

    <!--    <script src="https://kit.fontawesome.com/560f832382.js" crossorigin="anonymous"></script>-->

    {%if winner%}
    <style>
        .result__content:before {
            position: absolute;
            top: 0;
            left: 0;
            opacity: .6;
            z-index: -1;
            /*content: url("../static/imgs/map_img/{{map}}.jpg");*/
            /*content: url("../static/imgs/map_img/Mirage.jpg");*/
        }
    </style>
    {%endif%}
</head>
<body>
<div class="banner off">
    <div class="banner__container">
        <div class="banner__content">
            <h2 class="banner__title">ВНИМАНИЕ!</h2>
            <p class="banner__body">Названия команд должны отличаться!</p>
            <button class="banner__button">ОК</button>
        </div>
    </div>
</div>
<div id="fullpage">
    <div class="predict clearfix section">
        <div class="predict__container stick1 container clearfix">
            <div class="predict__content ">
                <form action="/" method="post" class="predict__form clearfix" id="predict__form"
                      name="prediction__form">
                    <!--КОМАНДА-1-->
                    <div class="predict__element clearfix">
                        <h2 class="clearfix">
                            <span>Команда 1</span>
                        </h2>

                        <!--                        <div class="ui icon input" style="">-->
                        <!--                            <input type="text" id="team1_search" placeholder="Название команды">-->
                        <!--                        </div>-->
                        <!--                        <input type="text" name="team1" id="team1" value="5POWER" hidden>-->
                        <!--                        <input type="text" name="team2" id="team2" value="1WIN" hidden>-->

                        <select class="ui dropdown search" name="team1" id="team1" onchange="teamOne()" required>
                            <option selected disabled value="">Выберите команду</option>
                            {%for team in teams%}
                            <option value="{{team}}">{{team}}</option>
                            {%endfor%}
                        </select>

                        <!--                    tut-->
                        <!--                        <div class="predict__teams-logo" id="team1_slider" style="width: 500px">-->
                        <!--                            {%for team in teams%}-->
                        <!--                            <div data-name="natus" class="vis">-->
                        <!--                                <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">-->
                        <!--                                                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                                <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                            </div>-->
                        <!--                        <div data-name="vici" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{vici}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        <div data-name="{{team}}" class="vis">-->
                        <!--                            &lt;!&ndash;                            <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">&ndash;&gt;-->
                        <!--                            <img src="../static/imgs/logos/9z.png" data-name="{{team}}" alt="">-->
                        <!--                            <h3 style="text-align: center">{{team}}</h3>-->
                        <!--                        </div>-->
                        <!--                        {%endfor%}-->
                        <!--                    </div>-->

                        <div class="predict__selected-team-logo">
                            <img src="" alt="" class="predict__team1-logo predict__team-logo">
                        </div>
                    </div>
                    <!--КОМАНДА-2-->
                    <div class="predict__element clearfix">
                        <h2 class="clearfix">
                            <span>Команда 2</span>
                        </h2>

                        <div class="ui modal" id="team2Modal">
                            <div class="header">Header</div>
                            <div class="content">
                                <input type="text" class="ui input" id="team2Filter">
                                <button class="ui button" id="team2FilterOk">Подтвердить</button>
                            </div>
                            <div class="scrolling content">
                                <div class="elements">
                                    {%for team in teams%}
                                    <div data-name="{{team}}" class="element">
                                        <img src="../static/imgs/logos/{{team}}.png" data-name="{{team}}" alt="">
                                        <h3 style="text-align: center">{{team}}</h3>
                                    </div>
                                    {%endfor%}
                                </div>
                            </div>
                        </div>

                        <button id="team2_choose">Выбрать команду</button>


<!--                        <select class="ui dropdown search" name="team2" id="team2" onchange="teamTwo()" required>-->
<!--                            <option selected disabled value="">Выберите команду</option>-->
<!--                            {%for team in teams%}-->
<!--                            <option value="{{team}}">{{team}}</option>-->
<!---->
<!--                            {%endfor%}-->
<!--                        </select>-->
                        <div class="predict__selected-team-logo">
                            <img src="" alt="" class="predict__team2-logo predict__team-logo">
                        </div>
                    </div>
                    <!--КАРТА-->
                    <div class="predict__element clearfix">
                        <h2 class="clearfix">
                            <span>Карта</span>
                        </h2>
                        <select name="map" id="map" class="ui dropdown search " onchange="map_logo()" required>
                            <option selected disabled value="">Выберите карту</option>
                            {%for map in maps%}
                            <option value="{{map}}" class="predict__select">{{map}}</option>
                            {%endfor%}
                        </select>
                        <div class="predict__selected-map-logo">
                            <img src="" alt="" id="predict__map-logo" class="predict__map-logo">
                        </div>
                    </div>
                    <!--SUBMIT-->
                    <input type="submit" class="predict__submit">
                </form>

                <div class="predict__entered">

                </div>
            </div>
        </div>
    </div>

    {%if winner%}
    <div class="result slide abs section active" id="res">
        <img src="../static/imgs/player-versus-player.png" class="result__versus" alt="" style="">

        <div class="result__container stick2 container">
            <div class="result__content clearfix">
                <div class="result__entered-data clearfix">
                    <div class="result__entered-data-teams">
                        <div class="result__team1 result__block">
                            <img src="../static/imgs/logos/{{team1}}.png" alt="{{team1}}" class="result__team-logo">
                            <!--                        <img src="../static/imgs/logos/1WIN.png" alt="{{team1}}" class="result__team-logo">-->
                            <h3>{{team1}}</h3>
                        </div>
                        <!--                    <div class="result__line"></div>-->
                        <div class="result__team2 result__block">
                            <img src="../static/imgs/logos/{{team2}}.png" alt="{{team2}}" class="result__team-logo">
                            <!--                        <img src="../static/imgs/logos/1WIN.png" alt="{{team1}}" class="result__team-logo">-->
                            <h3>{{team2}}</h3>
                        </div>
                    </div>
                </div>
                <!--            <div class="result__entered-data clearfix">-->
                <!--                <div class="result__map">-->
                <!--                    <img src="../static/imgs/map_logos/{{map}}.png" alt="{{map}}" class="result__team-logo">-->
                <!--                    <h3>{{map}}</h3>-->
                <!--                </div>-->
                <!--            </div>-->
                <!--            <h2 class="result__entered-data-title result__winner-title">Победитель:</h2>-->
                <!--            <div class="result__winner">-->
                <!--                <img src="../static/imgs/logos/{{winner}}.png" alt="{{winner}}"-->
                <!--                     class="result__team-logo" title="{{winner}}">-->
                <!--                <h3>{{winner}}</h3>-->
                <!--            </div>-->
            </div>
        </div>
        <!--        <div class="separate">    </div>-->
    </div>
    <div class="slide last abs section">
        <div class="stick3">
            <div class="choose-graph-style">
                <div class="choose-graph-style__container container">
                    <h2>Выберите вид гистограммы:</h2>
                    <div class="choose-graph-style__box">
                        <input type="radio" id="common" name="radio" checked onchange="change()">
                        <label for="common">Гистограмма с группировкой</label>

                        <input type="radio" id="stacked" name="radio" onchange="change()">
                        <label for="stacked">Вложеная гистограмма</label>
                    </div>
                </div>
            </div>

            <div class="graphs">
                <div class="graphs__container container">
                    <div class="graphs__content">
                        <div class="graphs__team1">
                            <canvas id="team1__graph"></canvas>
                        </div>
                        <div class="graphs__team2">
                            <canvas id="team2__graph"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script title="Graphs" type="text/javascript">

        function build(team, canvasID) {
            let path_matches = ' ../static/jsons/' + team + '_matches.json';
            let path__wins = '../static/jsons/' + team + '_wins.json';
            let request_m = new XMLHttpRequest();
            request_m.open('GET', path_matches);
            request_m.responseType = 'json';
            request_m.send();
            request_m.onload = function () {
                let request_w = new XMLHttpRequest();
                request_w.open('GET', path__wins);
                request_w.responseType = 'json';
                request_w.send();
                request_w.onload = function () {
                    let matchesJSON_unordered = request_m.response;
                    let winsJSON_unordered = request_w.response;
                    //матчи
                    const matchesJSON = {};
                    Object.keys(matchesJSON_unordered).sort().forEach(function (key) {
                        matchesJSON[key] = matchesJSON_unordered[key];
                    });
                    //победы
                    const winsJSON = {};
                    Object.keys(winsJSON_unordered).sort().forEach(function (key) {
                        winsJSON[key] = winsJSON_unordered[key];
                    });
                    let matches = Object.values(matchesJSON);
                    let wins = Object.values(winsJSON);
                    let stacked = document.getElementById('stacked').checked

                    var ctx = document.getElementById(canvasID).getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(matchesJSON),
                            datasets: [
                                {
                                    label: 'Количество побед команды ' + team,
                                    backgroundColor: 'rgba(65, 105, 225, 1)',
                                    data: wins,
                                },
                                {
                                    label: 'Количество матчей команды ' + team,
                                    backgroundColor: 'rgba(255, 99, 132, 1)',
                                    data: matches,
                                },]
                        },
                        options: {
                            scales: {
                                xAxes: [{
                                    stacked: stacked,
                                    gridLines: {
                                        color: '#fffff0',
                                    },
                                    ticks: {
                                        fontColor: '#ffffff'
                                    }
                                }],
                                yAxes: [{
                                    stacked: false,
                                    ticks: {
                                        fontColor: '#ffffff'
                                    },
                                    gridLines: {
                                        color: '#fffff0',
                                    },

                                }],
                            },
                            legend: {
                                labels: {
                                    fontColor: '#ffffff'
                                }
                            }
                        }
                    });
                }
            }
        }

        function change() {
            // $('#team1__graph').attr('id', 'team1__graph1')
            $('#team1__graph').remove();
            $('.graphs__team1').append('<canvas id="team1__graph"><canvas>');

            // $('#team2__graph').attr('id', 'team2__graph2')
            $('#team2__graph').remove();
            $('.graphs__team2').append('<canvas id="team2__graph"><canvas>');

            build('{{team1}}', 'team1__graph');
            build('{{team2}}', 'team2__graph');
        }

        window.onresize = function (event) {
            // $('#team1__graph').attr('id', 'team1__graph1')
            $('#team1__graph').remove();
            $('.graphs__team1').append('<canvas id="team1__graph"><canvas>');

            // $('#team2__graph').attr('id', 'team2__graph2')
            $('#team2__graph').remove();
            $('.graphs__team2').append('<canvas id="team2__graph"><canvas>');

            build('{{team1}}', 'team1__graph');
            build('{{team2}}', 'team2__graph');
        };

        build('{{team1}}', 'team1__graph');
        build('{{team2}}', 'team2__graph');
    </script>
    {%endif%}
</div>
<script type="text/javascript" src="../static/js/images.js"></script>

<script type="text/javascript" src="../static/pagepilling/jquery.pagepiling.min.js"></script>
<script>
    $(document).ready(() => {
        $('.ui.dropdown').dropdown({fullTextSearch: true});

        // $('#fullpage').fullpage({
        //     //options here
        //     autoScrolling: false,
        //     // licenseKey: 'YOUR KEY HERE',
        //
        //     // scrollHorizontally: true,
        // });

        $("#fullpage").pagepiling({
            // direction: 'horizontal',
            anchors: ['predict', 'result', 'graphs'],

        });
        // $.fn.pagepiling.moveTo(2);


        $(".predict__teams-logo").slick({
            centerMode: true,
            centerPadding: '60px',
            slidesToShow: 3,
            arrows: true,
            responsive: [
                {
                    breakpoint: 768,
                    settings: {
                        arrows: false,
                        centerMode: true,
                        centerPadding: '40px',
                        slidesToShow: 3
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        arrows: false,
                        centerMode: true,
                        centerPadding: '40px',
                        slidesToShow: 1
                    }
                }
            ],

            variableWidth: true,
            adaptiveHeight: true,
            infinite: false,
            slide: '.vis'
        });

        let team1_slider = $('#team1_slider .slick-list .slick-track div');
        console.log(team1_slider)
        $("#team1_search").keyup(function () {
            setTimeout(() => {
                let input_val = $("#team1_search").val().toLowerCase().trim();
                $('#team1_slider .slick-list .slick-track div').removeClass('hide');
                $('#team1_slider .slick-list .slick-track div').each(function (index) {
                    let team = $(this).data('name').toString().toLowerCase();
                    console.log($(this))
                    if (team.indexOf(input_val) == -1) {
                        console.log(team + " net")
                        // $(this).addClass("hide").removeClass('vis');
                        $(this)[0].remove();
                    } else {
                        console.log(team + ' yest')
                        // $(this).parents(".phone_department").addClass("show_dept");
                        $(this).removeClass('hide').addClass('vis');
                    }
                }, 1000);

                $('#team1_slider .slick-list .slick-track div')[0].classList.add("slick-current", "slick-center")
            });
            $(".predict__teams-logo").slick('unslick');

            $(".predict__teams-logo").slick({
                centerMode: true,
                centerPadding: '60px',
                slidesToShow: 3,
                arrows: true,
                responsive: [
                    {
                        breakpoint: 768,
                        settings: {
                            arrows: false,
                            centerMode: true,
                            centerPadding: '40px',
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            arrows: false,
                            centerMode: true,
                            centerPadding: '40px',
                            slidesToShow: 1
                        }
                    }
                ],

                variableWidth: true,
                adaptiveHeight: true,
                infinite: false,
                slide: '.vis'
            });

            if (input_val === '') {
                $("#team1_slider .slick-list .slick-track").empty().append(team1_slider)
                console.log("aaaaaaaaa")
            }

            //$(".phone_department.show_dept.hide").removeClass("show_dept").removeClass("hide");

        });

        $("#team2_choose").on('click', function (e) {
            e.preventDefault();
            $(".ui.modal").modal('show');
        });

        $("#team2Filter").keyup(function () {
            let input_val = $("#team2Filter").val().toLowerCase();
            $(".ui.modal .element").removeClass('hide');
            $(".ui.modal .element").each(function (index) {
                let team = $(this).data("name").toString().toLowerCase();
                if (team.indexOf(input_val) == -1) {
                    console.log(team + " net")
                    $(this).addClass("hide").removeClass('vis');
                } else {
                    console.log(team + ' yest')
                    // $(this).parents(".phone_department").addClass("show_dept");
                    $(this).removeClass('hide').addClass('vis');
                }
            });
        });

        $("#team2FilterOk").on('click', function (e) {
            e.preventDefault();

            $('.predict__team2-logo').attr('src', $(".ui.modal .element.choosen img")[0].src)
            $(".ui.modal").modal('hide');
        });


        $(".element").on('click', function () {
            if (!$(this).hasClass('choosen')) $('.element').removeClass('choosen');
            // console.log($(this))
            $(this).toggleClass('choosen');
        })
    });
</script>
</body>
</html>